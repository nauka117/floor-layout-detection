# Floor Layout Detection

Мини-прототип для извлечения стен из плана квартиры с помощью YOLOv8. Есть CLI и Streamlit UI.

## Что внутри
- UI: Streamlit для загрузки одного файла и скачивания результата.
- CLI: батч-обработка нескольких файлов, вывод JSON/картинки.

## Стек
- Python + Ultralytics YOLOv8
- Pillow / NumPy для пост-обработки и визуализации
- Streamlit для быстрого UI

## Быстрый старт (Docker, только UI)
1) Собрать образ:
```
docker build -t floor-layout .
```
2) Запустить Streamlit на localhost:8501:
```
docker compose up
# или без compose:
docker run --rm -p 8501:8501 floor-layout
```
3) Открыть http://localhost:8501, загрузить план, скачать JSON/картинку.

## Локальный запуск без Docker (CLI + UI)
Рекомендуется изолированное окружение:
```
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```
- CLI:
```
python src/main.py path/to/image.png --output-json result.json --output-image annotated.png
```
- UI:
```
streamlit run src/ui/streamlit.py
```

## Кратко о пайплайне
- Инференс YOLOv8 по входному плану → детекции bbox.
- Фильтрация по классу стен (`WALL_CLASS_ID=7`).
- Преобразование bbox в 2-точечную линию по центру (горизонт/вертикаль).
- Формирование JSON (`meta`, `walls`) и опциональная визуализация (Streamlit/CLI).
  Геометрия упрощена: линии проходят по центру bbox, без диагоналей/слияния сегментов.

## Модели и инструменты
- Ultralytics YOLOv8: готовая детекция объектов, быстрое прототипирование; подходит для грубого выделения стен как объектов.
- Pillow/NumPy: пост-обработка координат и отрисовка.
- Streamlit: минимальный UI для загрузки и просмотра результатов.

## Что улучшить далее
- Постобработка: объединение близких линий, поиск узлов (углы), построение полилиний/контуров.
- Дообучать модель под стены/двери/окна; добавить сегментацию помещений.
- Перспектива/шум: препроцессинг (deskew/denoise) и robust inference.
- Рассмотреть более классические варианты детекции (OpenCV).
- Рассмотреть более сложные архитектуры (дороже в смысле вычислений, но проще добиться лучшего результата). Можно использовать как для инференса, так и для обучения лёгких моделей.

## Примечания
- Предобученные веса YOLO лежат в `src/weights/yolo-v8/pretrained.pt`. В репозитории их нет, позже добавлю ссылку на их загрузку.
